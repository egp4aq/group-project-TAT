---
title: "final_proj"
format: html
editor_options: 
  chunk_output_type: console
---

```{r, message=FALSE, warning=FALSE}
rm(list=ls())
```

```{r, message=FALSE, warning=FALSE}
### **Loading Libraries**
library(here)
library(janitor)
library(tidyverse)
library(readr)
```

```{r, message=FALSE, warning=FALSE}
### **Read_files Function**

#Import data from multiple files into R
read_files <- function(file_names) {
  # Loop through the file names and read the CSV files into dynamically named variables
  for (i in seq_along(file_names)) {
    # Construct the dynamic name for the variable
    var_name <- paste0("data_", i)
    
    # Read the CSV file
    file_data <- read_csv(here(pathway, file_names[i]), na = c("-999", ""))
    # Assign the data frame to a variable with the constructed name
    assign(var_name, file_data, envir = .GlobalEnv)
  }
}
```

```{r, message=FALSE, warning=FALSE}
### **Data Cleaning Function**

#Process and merge data from all files

#Iterating through each single file to select the defined parameters and join all files
combined_df<-NULL
cleaning_function<-function(parameters){
  for (j in seq_along(variables)) {
    # Get the data frame associated with the current variable name
    current_data <- get(variables[j])
    # Select the desired columns (from parameters list)
    selected_col <- current_data %>% 
      select(parameters)
    # Perform a bind join 
    combined_df <- bind_rows(selected_col, combined_df)#bind_rows
    }
  return(combined_df)
}
```

```{r, message=FALSE, warning=FALSE}
### **Defining the Parameters**

#Link to where the data resides
pathway <- "/courses/EDS214/group_project/2024/tropical-aqua-titans/raw_data"

#Names of files
file_names <- c("RioMameyesPuenteRoto.csv", 
                "QuebradaCuenca1-Bisley.csv",
                "QuebradaCuenca2-Bisley.csv",
                "QuebradaCuenca3-Bisley.csv")

#Define Water Quality Parameters
parameters<-c("Sample_ID",
              "Sample_Date",
              "NO3-N",
              "K")

#Date Range
start_year <- 1989
end_year <- 1994
```

```{r, message=FALSE, warning=FALSE}
### **Running the Functions**

read_files(file_names)
variables <- ls(pattern = "^data_")
combined_df<-cleaning_function(parameters)
```

```{r, message=FALSE, warning=FALSE}
## [INSERT GRAPH FUNCTION HERE]

#plotting_function<-function(start_year,end_year){

# Filter the data by the specified year range
filtered_df <- combined_df %>%
  filter(between(lubridate::year(Sample_Date), start_year, end_year))
# Plotting the selected data
ggplot(data=filtered_df, aes(x=Sample_Date, y = K)) +geom_point(aes(color=Sample_ID))+ theme_minimal()
#}
```
