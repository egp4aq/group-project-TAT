---
title: "Version 2"
format: html
editor: visual
editor_options: 
  chunk_output_type: console
---

title: "final_proj"
format: html
editor_options:
  chunk_output_type: console
---
```{r, message=FALSE, warning=FALSE}
rm(list=ls())
```

```{r, message=FALSE, warning=FALSE}
### **Loading Libraries**
library(here)
library(janitor)
library(tidyverse)
library(readr)
```

```{r, message=FALSE, warning=FALSE}
### **Read_files Function**
#Import data from multiple files into R
read_files <- function(file_names) {
  # Loop through the file names and read the CSV files into dynamically named variables
  for (i in seq_along(file_names)) {
    # Construct the dynamic name for the variable
    var_name <- paste0("data_", i)
    # Read the CSV file
    file_data <- read_csv(here(pathway, file_names[i]), na = c("-999", ""))
    # Assign the data frame to a variable with the constructed name
    assign(var_name, file_data, envir = .GlobalEnv)
  }
}
```

```{r, message=FALSE, warning=FALSE}
### **Data Cleaning Function**
#Process and merge data from all files
#Iterating through each single file to select the defined parameters and join all files
combined_df<-NULL
cleaning_function<-function(parameters){
  for (j in seq_along(variables)) {
    # Get the data frame associated with the current variable name
    current_data <- get(variables[j])
    # Select the desired columns (from parameters list)
    selected_col <- current_data %>%
      select(parameters)
    # Perform a bind join
    combined_df <- bind_rows(selected_col, combined_df)#bind_rows
    }
  return(combined_df)
}
```

```{r, message=FALSE, warning=FALSE}
### **Defining the Parameters**
#Link to where the data resides
pathway <- "/courses/EDS214/group_project/2024/tropical-aqua-titans/raw_data"
#Names of files
file_names <- c("RioMameyesPuenteRoto.csv",
                "QuebradaCuenca1-Bisley.csv",
                "QuebradaCuenca2-Bisley.csv",
                "QuebradaCuenca3-Bisley.csv")
#Define Water Quality Parameters
parameters<-c("Sample_ID",
              "Sample_Date",
              "NO3-N",
              "K",
              "TSS")
#Date Range
start_year <- 1989
end_year <- 1994
```

```{r, message=FALSE, warning=FALSE}
### **Running the Functions**
read_files(file_names)
variables <- ls(pattern = "^data_")
combined_df<-cleaning_function(parameters)
combined_df <- clean_names(combined_df)
```

```{r}
filtered_df <- combined_df %>%
  filter(between(lubridate::year(sample_date), start_year, end_year)) %>%
  mutate(k = as.numeric(k)) %>%
  mutate(no3_n = as.numeric(no3_n)) %>%
  mutate(tss = as.numeric(tss))

```

```{r}
p1 <- ggplot(data = filtered_df, aes(x = sample_date, y = tss, color = sample_id)) +
  geom_line() +
  scale_y_continuous(limits = c(from = 0, to = 2000, by = 200)) +
  labs(x = "Date", y = "Total Suspended Solids (mg/L)") +
  facet_wrap(~ sample_id) +
  scale_color_manual(values = c("#C0DF85", "#EE85B5", "#90E0F3", "#F39C6B"),
                    name = "Location: ",
                    labels = c("PRM", "BQ1", "BQ2", "BQ3")) +
  theme_classic() +
  geom_vline(xintercept = as.numeric(filtered_df$sample_date[39]), color = "black", linetype = "dashed")
```


```{r}
# tss for 2015 - 2018

#new date range
start_2015 <- 2015
end_2018 <- 2018
```

```{r}
df_2015_2018 <- combined_df %>%
  filter(between(lubridate::year(sample_date), start_2015, end_2018)) %>%
  mutate(k = as.numeric(k)) %>%
  mutate(no3_n = as.numeric(no3_n)) %>%
  mutate(tss = as.numeric(tss))
```

```{r}
p2 <- ggplot(data = df_2015_2018, aes(x = sample_date, y = tss, color = sample_id)) +
  geom_line() +
  scale_y_continuous(limits = c(from = 0, to = 300, by = 100)) +
  labs(x = "Date", y = "Total Suspended Solids (mg/L)") +
  facet_wrap(~ sample_id) +
  scale_color_manual(values = c("#C0DF85", "#EE85B5", "#90E0F3", "#F39C6B"),
                    name = "Location: ",
                    labels = c("PRM", "BQ1", "BQ2", "BQ3")) +
  theme_classic() +
  geom_vline(xintercept = as.numeric(df_2015_2018$sample_date[142]), color = "black", linetype = "dashed")
```

```{r}
ggsave(here("p2.jpeg"))
ggsave(here("p1.jpeg"))
```

